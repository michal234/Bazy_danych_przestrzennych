1. CREATE DATABASE s290135;
2. CREATE SCHEMA firma;
3. CREATE ROLE ksiegowosc;
GRANT SELECT ON ALL TABLES IN SCHEMA firma TO ksiegowosc;
4. a)
CREATE TABLE firma.pracownicy( id_pracownika INT NOT NULL UNIQUE, imie VARCHAR, nazwisko VARCHAR, adres VARCHAR, telefon VARCHAR(9) );
CREATE TABLE firma.godziny( id_godziny INT NOT NULL UNIQUE, data DATE, liczba_godzin INT, id_pracownika INT NOT NULL );
CREATE TABLE firma.pensja_stanowisko( id_pensji INT NOT NULL UNIQUE, stanowisko VARCHAR, kwota FLOAT(2) );
CREATE TABLE firma.premia( id_premii INT NOT NULL UNIQUE, rodzaj VARCHAR, kwota FLOAT(2) );
CREATE TABLE firma.wynagrodzenie( id_wynagrodzenia INT NOT NULL UNIQUE, data DATE, id_pracownika INT NOT NULL, id_godziny INT NOT NULL, id_pensji INT NOT NULL, id_premii INT NOT NULL);

b)
ALTER TABLE firma.pracownicy ADD PRIMARY KEY(id_pracownika);
ALTER TABLE firma.godziny ADD PRIMARY KEY(id_godziny);
ALTER TABLE firma.pensja_stanowisko ADD PRIMARY KEY(id_pensji);
ALTER TABLE firma.premia ADD PRIMARY KEY(id_premii);
ALTER TABLE firma.wynagrodzenie ADD PRIMARY KEY(id_wynagrodzenia);

c)
ALTER TABLE firma.godziny ADD FOREIGN KEY(id_pracownika) REFERENCES firma.pracownicy(id_pracownika);
ALTER TABLE firma.wynagrodzenie ADD FOREIGN KEY(id_godziny) REFERENCES firma.godziny(id_godziny);
ALTER TABLE firma.wynagrodzenie ADD FOREIGN KEY(id_pensji) REFERENCES firma.pensja_stanowisko(id_pensji);
ALTER TABLE firma.wynagrodzenie ADD FOREIGN KEY(id_premii) REFERENCES firma.premia(id_premii);

d)
CREATE CLUSTERED INDEX pracownik_ind ON firma.wynagrodzenie(id_pracownika);

e)
COMMENT ON TABLE firma.pracownicy IS 'Zawiera dane o pracownikach firmy';
COMMENT ON TABLE firma.godziny IS 'Zawiera dane o godzinach przepracowanych przez pracownika';
COMMENT ON TABLE firma.pensja_stanowisko IS 'Zawiera dane o pensji w odniesieniu do stanowiska';
COMMENT ON TABLE firma.premia IS 'Zawiera dane o możliwych premiach i ich wielkościach';
COMMENT ON TABLE firma.wynagrodzenie IS 'Zawiera dane o tym, jakie wynagrodzenie dostal dany pracownik uwzgleniajac liczbe godzin, pensje, premie i date wyplaty wynagrodzenia';

f)
ALTER TABLE firma.godziny ADD FOREIGN KEY(id_pracownika) REFERENCES firma.pracownicy(id_pracownika) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE firma.wynagrodzenie ADD FOREIGN KEY(id_godziny) REFERENCES firma.godziny(id_godziny) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE firma.wynagrodzenie ADD FOREIGN KEY(id_pensji) REFERENCES firma.pensja_stanowisko(id_pensji) ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE firma.wynagrodzenie ADD FOREIGN KEY(id_premii) REFERENCES firma.premia(id_premii) ON UPDATE NO ACTION ON DELETE NO ACTION;

5.
b)
ALTER TABLE firma.wynagrodzenie ALTER COLUMN data TYPE VARCHAR;

6.
a) SELECT id_pracownika, nazwisko FROM firma.pracownicy;
b) SELECT DISTINCT pracownicy.id_pracownika FROM ((firma.pracownicy INNER JOIN firma.wynagrodzenie ON pracownicy.id_pracownika = wynagrodzenie.id_pracownika) INNER JOIN firma.pensja_stanowisko ON wynagrodzenie.id_pensji = pensja_stanowisko.id_pensji) WHERE pensja_stanowisko.kwota > 1000 ORDER BY id_pracownika;
c) SELECT pracownicy.id_pracownika FROM (((firma.pracownicy INNER JOIN firma.wynagrodzenie ON pracownicy.id_pracownika = wynagrodzenie.id_pracownika) INNER JOIN firma.pensja_stanowisko ON wynagrodzenie.id_pensji = pensja_stanowisko.id_pensji) INNER JOIN firma.premia ON wynagrodzenie.id_premii = premia.id_premii) WHERE pensja_stanowisko.kwota > 2000 AND premia.kwota = 0;
d) SELECT * FROM firma.pracownicy WHERE imie LIKE 'J%';
e) SELECT * FROM firma.pracownicy WHERE nazwisko LIKE '%n%' AND imie LIKE '%a';
f) 
g) SELECT pracownicy.imie, pracownicy.nazwisko FROM ((firma.pracownicy INNER JOIN firma.wynagrodzenie ON pracownicy.id_pracownika = wynagrodzenie.id_pracownika) INNER JOIN firma.pensja_stanowisko ON wynagrodzenie.id_pensji = pensja_stanowisko.id_pensji) WHERE pensja_stanowisko.kwota >= 1500 AND pensja_stanowisko.kwota <= 3000 GROUP BY pracownicy.nazwisko, pracownicy.imie;
h)

7.
a) SELECT imie, nazwisko, kwota FROM (firma.pracownicy INNER JOIN firma.wynagrodzenie ON pracownicy.id_pracownika = wynagrodzenie.id_pracownika) INNER JOIN firma.pensja_stanowisko ON wynagrodzenie.id_pensji = pensja_stanowisko.id_pensji GROUP BY imie, nazwisko, kwota ORDER BY pensja_stanowisko.kwota;
b) SELECT imie, nazwisko, pensja_stanowisko.kwota, premia.kwota FROM ((firma.pracownicy INNER JOIN firma.wynagrodzenie ON pracownicy.id_pracownika = wynagrodzenie.id_pracownika) INNER JOIN firma.pensja_stanowisko ON wynagrodzenie.id_pensji = pensja_stanowisko.id_pensji) INNER JOIN firma.premia ON wynagrodzenie.id_premii = premia.id_premii GROUP BY imie, nazwisko, pensja_stanowisko.kwota, premia.kwota ORDER BY pensja_stanowisko.kwota DESC, premia.kwota DESC;